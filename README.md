# UTSU ‚Äì Forum bienveillant

## Auteurs  
- **Hamdaoui Mayssa**  
- **Merlo Meyffren Antonin**

---

## üìå Description

**UTSU** est un forum communautaire qui met l'accent sur la **bienveillance**, le **respect** et les **√©changes intelligents**.  
Inspir√© de Reddit, il propose diverses cat√©gories et sous-forums o√π les utilisateurs peuvent :  
- publier du contenu (texte, images),
- commenter et r√©pondre,
- liker ou disliker,
- suivre d'autres membres.

Le syst√®me de r√©putation valorise les comportements positifs :
- ‚úÖ Les utilisateurs bienveillants obtiennent des **grades √©lev√©s** et sont **mis en avant** publiquement.
- ‚ùå Les comportements toxiques ou un mauvais usage du fran√ßais peuvent mener √† une **d√©gradation du statut**, voire un **bannissement**.

---

## üèóÔ∏è Architecture du Projet

### Structure Technique
```
utsu-site/
‚îú‚îÄ‚îÄ assets/              # Assets frontend (SCSS, JS, images)
‚îú‚îÄ‚îÄ bin/                 # Scripts ex√©cutables
‚îú‚îÄ‚îÄ config/             # Configuration Symfony
‚îú‚îÄ‚îÄ migrations/         # Migrations de base de donn√©es
‚îú‚îÄ‚îÄ public/             # Point d'entr√©e public
‚îú‚îÄ‚îÄ src/                # Code source PHP
‚îÇ   ‚îú‚îÄ‚îÄ Controller/     # Contr√¥leurs
‚îÇ   ‚îú‚îÄ‚îÄ Entity/         # Entit√©s Doctrine
‚îÇ   ‚îú‚îÄ‚îÄ Repository/     # Repositories
‚îÇ   ‚îî‚îÄ‚îÄ Service/        # Services m√©tier
‚îú‚îÄ‚îÄ templates/          # Templates Twig
‚îú‚îÄ‚îÄ tests/              # Tests unitaires et fonctionnels
‚îî‚îÄ‚îÄ translations/       # Fichiers de traduction
```

### Stack Technologique
- **Backend**: PHP 8.2, Symfony 7.2
- **Frontend**: Twig, JavaScript, Stimulus.js
- **Base de donn√©es**: PostgreSQL 16
- **Cache**: Redis
- **Serveur Web**: Nginx
- **CI/CD**: GitLab CI
- **Authentification**: JWT

### Architecture Logicielle
1. **Couche Pr√©sentation**
   - Contr√¥leurs Symfony
   - Templates Twig
   - Assets frontend

2. **Couche M√©tier**
   - Services Symfony
   - Logique m√©tier
   - Validation des donn√©es

3. **Couche Donn√©es**
   - Entit√©s Doctrine
   - Repositories
   - Migrations

4. **S√©curit√©**
   - Authentification JWT
   - Gestion des r√¥les
   - Protection CSRF
   - Validation des entr√©es

---

## üöÄ Installation et Configuration

### Pr√©requis
- PHP 8.2 ou sup√©rieur
- Composer
- PostgreSQL 16
- Node.js et npm
- Docker et Docker Compose

### Installation

1. Cloner le repository
```bash
git clone [URL_DU_REPO]
cd utsu-site
```

2. Installer les d√©pendances PHP
```bash
composer install
```

3. Installer les d√©pendances JavaScript
```bash
npm install
```

4. Configurer l'environnement
```bash
cp .env .env.local
```
Modifier les variables d'environnement dans `.env.local` selon vos besoins.

5. D√©marrer les conteneurs Docker
```bash
docker compose up -d
```

6. Cr√©er la base de donn√©es
```bash
php bin/console doctrine:database:create
php bin/console doctrine:migrations:migrate
```

7. Charger les fixtures (optionnel)
```bash
php bin/console doctrine:fixtures:load
```

8. Compiler les assets
```bash
npm run dev
```

### Structure D√©taill√©e du Projet

#### Backend (src/)
- `Controller/` - Contr√¥leurs de l'application
- `Entity/` - Entit√©s Doctrine
- `Repository/` - Repositories pour les requ√™tes personnalis√©es
- `Form/` - Formulaires Symfony
- `Security/` - Configuration de s√©curit√©
- `EventListener/` - √âcouteurs d'√©v√©nements
- `DataFixtures/` - Donn√©es de test

#### Frontend (templates/)
- `base.html.twig` - Template de base
- `account/` - Pages de gestion de compte
- `posts/` - Gestion des publications
- `categories/` - Gestion des cat√©gories
- `commentaires/` - Syst√®me de commentaires
- `notification/` - Syst√®me de notifications
- `search/` - Fonctionnalit√©s de recherche
- `security/` - Pages d'authentification
- `share/` - Fonctionnalit√©s de partage

#### Assets (assets/)
- `styles/` - Fichiers CSS
- `controllers/` - Contr√¥leurs Stimulus
- `icon/` - Ic√¥nes et images

### Fonctionnalit√©s Principales

#### Authentification et S√©curit√©
- **Syst√®me d'authentification JWT**
  - Authentification s√©curis√©e avec JSON Web Tokens
  - Gestion des sessions utilisateur
  - Protection contre les attaques CSRF
  - Validation des tokens et gestion des expirations

- **Gestion des r√¥les utilisateurs**
  - Hi√©rarchie de r√¥les (Admin, Mod√©rateur, Utilisateur)
  - Permissions granulaires par fonctionnalit√©
  - Syst√®me de promotion/d√©gradation automatique bas√© sur le comportement

#### Gestion de Contenu
- **Syst√®me de Posts**
  - Cr√©ation de posts avec support multim√©dia
  - √âdition et suppression de posts
  - Syst√®me de brouillon
  - Historique des modifications
  - Support du markdown
  - Syst√®me de tags et cat√©gories

- **Syst√®me de Commentaires**
  - Commentaires imbriqu√©s (r√©ponses aux commentaires)
  - √âdition et suppression de commentaires
  - Syst√®me de mod√©ration des commentaires
  - Notifications pour les r√©ponses
  - Support du markdown dans les commentaires

#### Interface Utilisateur
- **Design Responsive**
  - Interface adaptative pour tous les appareils
  - Th√®me clair/sombre
  - Personnalisation de l'interface utilisateur
  - Animations fluides et transitions

- **Syst√®me de Notifications**
  - Notifications en temps r√©el
  - Notifications par email
  - Centre de notifications
  - Pr√©f√©rences de notification personnalisables

#### Mod√©ration et Administration
- **Panneau de Mod√©ration**
  - Interface de mod√©ration intuitive
  - File d'attente de mod√©ration
  - Historique des actions de mod√©ration
  - Syst√®me de rapports
  - Actions en masse

### CI/CD avec GitLab

#### Pipeline d'Int√©gration Continue
Le projet utilise GitLab CI/CD pour l'automatisation des tests et la v√©rification de la qualit√© du code.

#### √âtapes de la Pipeline
1. **SecurityChecker**
   - V√©rification des vuln√©rabilit√©s de s√©curit√©
   - Analyse du code avec phpcs pour la s√©curit√©

2. **CodingStandards**
   - V√©rification des standards de code avec phpcs
   - Analyse statique avec phpstan

3. **UnitTests**
   - Ex√©cution des tests unitaires avec PHPUnit

### Commandes Utiles
```bash
# D√©marrer le serveur de d√©veloppement
symfony server:start

# V√©rifier les routes
php bin/console debug:router

# Cr√©er une migration
php bin/console make:migration

# Vider le cache
php bin/console cache:clear
```

---

## üß™ Tests

### Types de Tests
1. **Tests Unitaires**
   - Tests des services et composants individuels
   - Utilisation de PHPUnit
   - Couverture de code avec PHPUnit Coverage

2. **Tests Fonctionnels**
   - Tests des fonctionnalit√©s compl√®tes
   - Tests des contr√¥leurs
   - Tests des formulaires

3. **Tests d'Int√©gration**
   - Tests des interactions entre composants
   - Tests de la base de donn√©es
   - Tests des API

### Ex√©cution des Tests
```bash
# Ex√©cuter tous les tests
php bin/phpunit

# Ex√©cuter les tests avec couverture
php bin/phpunit --coverage-html coverage/

# Ex√©cuter un groupe de tests sp√©cifique
php bin/phpunit --group=unit
```

---

## ü§ù Contribution

### Processus de Contribution
1. **Fork du Projet**
   - Cr√©er un fork du projet
   - Cloner votre fork localement

2. **Branches**
   - Cr√©er une branche pour votre fonctionnalit√©
   - Nommer la branche selon le format : `feature/nom-fonctionnalite`

3. **D√©veloppement**
   - Suivre les standards de code
   - √âcrire des tests pour les nouvelles fonctionnalit√©s
   - Documenter les changements

4. **Pull Request**
   - Mettre √† jour votre fork
   - Cr√©er une Pull Request
   - D√©crire les changements en d√©tail

### Standards de Code
- PSR-12 pour le PHP
- ESLint pour le JavaScript
- Stylelint pour le CSS/SCSS
- Documentation PHPDoc

---

## üöÄ D√©ploiement

### Environnements
1. **D√©veloppement**
   - Serveur local avec Docker
   - Base de donn√©es PostgreSQL locale
   - Assets en mode d√©veloppement

2. **Staging**
   - Serveur de pr√©-production
   - Base de donn√©es de test
   - Configuration similaire √† la production

3. **Production**
   - Serveur de production
   - Base de donn√©es de production
   - Optimisations activ√©es

### Processus de D√©ploiement
1. **Pr√©paration**
   ```bash
   # Compiler les assets pour la production
   npm run build
   
   # Vider le cache
   php bin/console cache:clear --env=prod
   ```

2. **D√©ploiement**
   ```bash
   # Mettre √† jour le code
   git pull origin main
   
   # Mettre √† jour les d√©pendances
   composer install --no-dev --optimize-autoloader
   
   # Appliquer les migrations
   php bin/console doctrine:migrations:migrate --env=prod
   ```

3. **V√©rification**
   - Tests de smoke
   - V√©rification des logs
   - Monitoring des performances

---

## üóÑÔ∏è Sch√©ma et Description de la Base de Donn√©es

![Diagramme de la base de donn√©es](./docs/image.png)

La base de donn√©es du projet Utsu Site est con√ßue pour g√©rer efficacement les interactions sociales, la mod√©ration et la gestion de contenu. Voici une description des principales tables :

- **user** :
  - G√®re les comptes utilisateurs (email, r√¥les, mot de passe, image de profil, type, nom d'utilisateur, statut de dangerosit√©).

- **posts** :
  - Contient les publications des utilisateurs, associ√©es √† une cat√©gorie et √† un utilisateur. Supporte le contenu texte, les images, la date de publication et un indicateur de contenu dangereux.

- **commentaires** :
  - G√®re les commentaires sur les posts, avec support des r√©ponses imbriqu√©es (com_parent_id), images, vid√©os, date de cr√©ation et auteur.

- **categories** :
  - Liste les diff√©rentes cat√©gories de posts, avec un indicateur de dangerosit√©.

- **likes** :
  - Permet aux utilisateurs d'aimer ou de disliker des posts. Stocke l'utilisateur, le post et le type d'interaction.

- **abonnement** :
  - G√®re les abonnements entre utilisateurs et/ou cat√©gories (suivi d'utilisateurs ou de cat√©gories).

- **notification** :
  - Stocke les notifications envoy√©es aux utilisateurs (li√©es √† un commentaire, √©tat de lecture, date de cr√©ation).

- **doctrine_migration_versions** :
  - Historique des migrations Doctrine (version, date d'ex√©cution, temps d'ex√©cution).

- **messenger_messages** :
  - Messages utilis√©s par le composant Messenger de Symfony (file d'attente, corps, en-t√™tes, dates).

Ce sch√©ma relationnel permet de garantir l'int√©grit√© des donn√©es, la performance des requ√™tes et la flexibilit√© pour l'√©volution future de la plateforme.

---

## üìä Diagrammes UML

### Diagramme de Classes
```mermaid
classDiagram
    User "1" -- "*" Post : Cr√©e
    User "1" -- "*" Comment : Commente
    User "*" -- "*" User : Suit (Follow)
    Post "1" -- "*" Comment : Contient
    Post "*" -- "*" Category : Appartient √†
    Post "1" -- "*" Likes : Re√ßoit
    User "1" -- "*" Likes : Donne

    class User {
        +ID
        +username
        +email
        +pp_img
        +password
        +type
        +statut
        +roles
        +dangerous
    }

    class Post {
        +ID
        +user_id
        +cat_id
        +title
        +contenu
        +date
        +photo
        +dangerous
    }

    class Comment {
        +ID
        +id_post
        +id_com_parent
        +contenu
        +img
        +video
        +date_creation
        +user_id_id
    }

    class Category {
        +ID
        +name
        +dangerous
    }

    class Likes {
        +ID
        +user_id
        +post_id
        +type
    }

    class Abonnement {
        +ID
        +user_id
        +category_id
        +followed_user_id
    }

    class Notification {
        +ID
        +user_id
        +comment_id
        +is_read
        +created_at
    }

    class DoctrineMigrationVersions {
        +version
        +executed_at
        +execution_time
    }

    class MessengerMessages {
        +id
        +body
        +headers
        +queue_name
        +created_at
        +available_at
        +delivered_at
    }
```

### Diagramme de S√©quence (Cr√©ation de Post)
```mermaid
sequenceDiagram
    participant U as Utilisateur
    participant C as Controller
    participant S as Service
    participant R as Repository
    participant DB as Database

    U->>C: Requ√™te HTTP (POST /posts)
    C->>S: Appelle createPost(data)
    S->>S: Valide les donn√©es
    S->>R: Appelle save(PostEntity)
    R->>DB: INSERT INTO posts (...)
    DB-->>R: Confirmation
    R-->>S: Post cr√©√©
    S-->>C: Succ√®s
    C->>U: Redirection ou R√©ponse JSON
```

### Diagramme d'√âtat (Post)
```mermaid
stateDiagram-v2
    [*] --> Draft
    Draft --> Published: Publier
    Published --> Archived: Archiver
    Published --> Deleted: Supprimer
    Archived --> Deleted: Supprimer
    Deleted --> [*]
```

---

## üîí S√©curit√©

### Authentification
- JWT pour l'authentification API
- Sessions s√©curis√©es pour le web
- Protection contre les attaques par force brute
- Gestion des tokens de r√©initialisation

### Autorisation
- RBAC (Role-Based Access Control)
- V√©rification des permissions
- Validation des entr√©es utilisateur
- Protection CSRF sur tous les formulaires

### Protection des Donn√©es
- Chiffrement des donn√©es sensibles
- Hachage des mots de passe (Argon2id)
- Validation des fichiers upload√©s
- Protection contre les injections SQL

### S√©curit√© de l'Application
- Headers de s√©curit√© (CSP, HSTS, etc.)
- Rate limiting
- Validation des entr√©es
- Protection XSS
- Logging des actions sensibles

### Bonnes Pratiques
- Mise √† jour r√©guli√®re des d√©pendances
- Scan de vuln√©rabilit√©s
- Audit de s√©curit√©
- Documentation des proc√©dures de s√©curit√©

---

## üß© Mod√®le de base de donn√©es (UML simplifi√©)

### `Users`
- `ID` (BIGINT, PK)  
- `username` (TEXT, NOT NULL)  
- `email` (TEXT, NOT NULL, UNIQUE)  
- `pp_img` (BLOB)  
- `password` (TEXT, NOT NULL)  
- `type` (INT, NOT NULL)  
- `statut` (INT, NOT NULL)

### `Categories`
- `ID` (BIGINT, PK)  
- `name` (TEXT, NOT NULL)

### `Posts`
- `ID` (BIGINT, PK)  
- `user_id` (BIGINT, FK ‚Üí Users.ID, ON DELETE CASCADE)  
- `cat_id` (BIGINT, FK ‚Üí Categories.ID, ON DELETE CASCADE)  
- `title` (TEXT, NOT NULL)  
- `contenu` (TEXT, NOT NULL)  
- `date` (DATETIME, NOT NULL, DEFAULT CURRENT_TIMESTAMP)  
- `photo` (BLOB)

### `Commentaires`
- `ID` (BIGINT, PK)  
- `id_post` (BIGINT, FK ‚Üí Posts.ID, ON DELETE CASCADE)  
- `id_com_parent` (BIGINT, FK ‚Üí Commentaires.ID, NULL)  
- `contenu` (TEXT, NOT NULL)  
- `img` (BLOB)  
- `video` (BLOB)  
- `date_creation` (DATETIME, NOT NULL, DEFAULT CURRENT_TIMESTAMP)

### `Likes`
- `ID` (BIGINT, PK)  
- `user_id`

## üìã Sp√©cifications Fonctionnelles

### R√¥les Utilisateurs

1. **Visiteur (Non authentifi√©)**
   - Consultation des posts publics
   - Inscription/Connexion
   - Recherche de contenu

2. **Utilisateur Authentifi√©**
   - Cr√©ation et modification de posts
   - Commentaires et r√©ponses
   - Like/Dislike
   - Suivi d'autres utilisateurs
   - Gestion du profil
   - Notifications

3. **Mod√©rateur**
   - Gestion des contenus inappropri√©s
   - Attribution des grades
   - Gestion des utilisateurs
   - Acc√®s aux statistiques

### Cas d'Utilisation Principaux

1. **Publication de Contenu**
   ```
   Utilisateur -> Connexion -> S√©lection Cat√©gorie -> Cr√©ation Post -> Upload Media -> Publication
   ```

2. **Interaction Communautaire**
   ```
   Utilisateur -> Consultation Post -> Commentaire/Like -> Notification -> R√©ponse
   ```

3. **Gestion de la R√©putation**
   ```
   Syst√®me -> Analyse Comportement -> Attribution Grade -> Mise √† jour Statut
   ```

### Contraintes Non Fonctionnelles

1. **Performance**
   - Temps de chargement < 2 secondes
   - Optimisation des images
   - Mise en cache Redis
   - Pagination des r√©sultats

2. **S√©curit√©**
   - Authentification s√©curis√©e
   - Protection XSS/CSRF
   - Validation des entr√©es
   - Gestion s√©curis√©e des fichiers

3. **Accessibilit√©**
   - Conformit√© WCAG 2.1
   - Support lecteurs d'√©cran
   - Navigation clavier
   - Contraste suffisant

4. **Maintenabilit√©**
   - Tests unitaires
   - Documentation du code
   - Standards de codage
   - CI/CD automatis√©